@model ShoppingCart

@{
    ViewData["Title"] = "Details";
}

<style>

</style>

<link rel="stylesheet" href="~/css/details.css" asp-append-version="true" />


<form method="post" asp-action="Details">

    <input hidden asp-for="ProductId" />

    <div class="container mt-4 mb-4 justify-content-center align-items-center position-relative">
        <div class="fs-6">
            <a asp-action="Index" class="mt-4 mb-4 text-md-start small_grey_text_css text-decoration-none gap-3"><i class="bi bi-arrow-left pe-2 back-icon"></i>Back To Home</a>
        </div>

        <div class="row mt-4">
            <div class="col-sm-12 col-md-5">
                <img src="~/@Model.Product.ProductImageUrl" alt="@Model.Product.ProductName" height="375px" width="100%">
            </div>
            <div class="col-sm-12 col-md-5 small_grey_text_css text d-flex flex-column justify-content-center">
                <h3 class="">@Model.Product.ProductName</h3>
                <p class="small_grey_text_css mb-2">Category: @Model.Product.Category.Name</p>
                <p class="small_grey_text_css mb-2">pID: @Model.Product.ProductId</p>
                <p class="small_grey_text_css mb-2">Price: Rs @Model.Product.Price</p>
                <p class="small_grey_text_css mb-2">SellerId: @Model.Product.UserId</p>
                <p class="small_grey_text_css mb-2">@Model.Product.ProductDescription</p>

                <div class="d-flex align-items-center gap-2">
                    <label class="" for="quanitty">Add Quantity</label>
                    <input asp-for="Quantity" type="number" min="1" value="1" />
                    <button type="submit" class="favorite-btn" asp-controller="Customer" asp-action="AddToFavorite" asp-route-ProductId="@Model.Product.ProductId"><i class="favorite-icon fs-3 bi bi-heart-fill ms-4"></i></button>
                </div>                 

                @if (User.IsInRole(StaticDetail.CustomerRole) || User.IsInRole(StaticDetail.AdminRole))
                {
                    <button type="submit" class="btn btn-success w-100 mt-5">Add To Cart</button>
                    <a asp-action="Index" class="signup_btn continue mt-2 text-center">Continue Shopping</a>

                }
                else
                {
                    <button type="submit" class="btn btn-success w-100 mt-5 disabled">Add To Cart</button>
                    @* <a asp-action="Index" class="signup_btn continue mt-2 text-center">Continue Shopping</a> *@
                }

            </div>
        </div>

        <!-- Comment Section -->
        <div class="row-cols-2">
            <div class="mt-5">

                @if (User.IsInRole(StaticDetail.CustomerRole))
                {
                    <h6 class="text-success">Leave your questions below</h6>
                }
                else
                {
                    <h3>Comment of users </h3>
                }


                <!-- Include the partial view for comments -->
                <div id="commentsSection">
                    <!-- Render the comments section using the partial view -->
                    @Html.Partial("_CommentsPartial", Model.Product.ProductComments)
                </div>

                @if (User.IsInRole(StaticDetail.CustomerRole))
                {

                    <!-- Form to submit a new comment -->
                    <form id="commentForm">
                        <textarea class="p-2" id="commentText" rows="2" cols="50" placeholder="Write a comment..."></textarea><br />
                        <button id="submitComment" class="btn btn-sm purple-background text-white" type="button">Comment</button>
                    </form>

                }
            </div>

        </div>
        <!-- End of Comment Section -->

    </div>
</form>

<script>
    $(document).ready(function () {
        // Submit new comment
        $("#submitComment").click(function () {
            var productId = "@Model.Product.ProductId";
            var commentText = $("#commentText").val();

            $.ajax({
                type: "POST",
                url: "/Customer/SubmitProductComment",
                data: { productId: productId, commentText: commentText },
                success: function (result) {
                    $('#commentsSection').html(result);
                    $("#commentText").val("");
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });

        // Submit new reply
        $(".submitReply").click(function () {
            var commentId = $(this).siblings(".commentId").val();
            var replyText = $(this).siblings(".replyText").val();

            // Store a reference to the button that was clicked
            var clickedButton = $(this);

            $.ajax({
                type: "POST",
                url: "/Customer/SubmitProductReply",
                data: { commentId: commentId, replyText: replyText },
                success: function (result) {
                    $('#replies_' + commentId).html(result);
                    // Empty the reply text area after successful submission
                    clickedButton.siblings(".replyText").val(""); // Use the stored reference to access the reply text area
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });


    });



</script>